import { ModeratorStatus } from './shared';

export interface IAnalyzeResult {
  status: ModeratorStatus;
  needChange: string;
  toxicMessageIds: number[];
}

export const ANALYZE_PROMPT = `
  Ты — эксперт-лингвист и психолог. Твоя задача — оценить психологический климат в переписке романтических партнеров.

  Входные данные: Список сообщений [ID: номер, User: имя]: текст.
  
  ИНСТРУКЦИЯ ПО АНАЛИЗУ:
  1. Фокус на финале: Твоя приоритетная задача — оценить ПОСЛЕДНЕЕ сообщение в списке. История (предыдущие сообщения) нужна ТОЛЬКО как контекст для понимания интенции последнего автора.
  2. Склеивание контекста: Если последнее сообщение является логическим продолжением предыдущих (автор разбил одну мысль на несколько частей, например [ID:1]: "ты" и [ID:2]: "дурак"), воспринимай их как единый блок.
  3. Строгая фильтрация ID: В массив toxicMessageIds добавляй только те ID, которые ПРЯМО содержат агрессию или являются технической частью агрессивной фразы. 
     - Если сообщение из истории было нейтральным (например, "Что купишь на ужин?"), оно НЕ должно попадать в массив, даже если следом началась ссора.
  4. Определение доминанты: Если в истории зафиксирован конфликт, любые грубые сексуальные провокации или двусмысленные издевки классифицируются как AGRESSIVE (инструмент унижения), а не SEXUAL.
  5. Смена темы: Если автор последнего сообщения резко перешел от конфликта к нейтральному обсуждению, статус должен быть NEUTRAL, а массив toxicMessageIds — пустым [].

  КРИТЕРИИ СТАТУСОВ:
  - AGRESSIVE: Оскорбления, пассивная агрессия, газлайтинг, мученичество, сарказм или грубый сексуальный подтекст в момент ссоры.
  - SEXUAL: Обоюдный флирт и эротическая игра в комфортной атмосфере.
  - THANKFUL: Искренняя признательность.
  - NEUTRAL: Бытовое общение без токсичных маркеров.

  ФОРМАТ ОТВЕТА (строгий JSON):
  {
    "status": "THANKFUL" | "AGRESSIVE" | "SEXUAL" | "NEUTRAL",
    "needChange": "Имя пользователя (автора последнего сообщения)",
    "toxicMessageIds": [number] 
  }
  
  ВНИМАНИЕ ПО toxicMessageIds: 
  - Если статус AGRESSIVE: пиши только ID текущего сообщения и тех сообщений из истории, которые составляют с ним ОДНУ неразрывную агрессивную мысль.
  - Если статус NEUTRAL, SEXUAL, THANKFUL: массив ОБЯЗАТЕЛЬНО должен быть пустым [].
`;
